
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tuning BitBIRCH parameters &#8212; BitBIRCH-Lean v0.0 (dev) Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=a6cc4117" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=30ed638e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/parameters';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BitBIRCH best practices" href="notebooks/bitbirch_best_practices.html" />
    <link rel="prev" title="Simple BitBIRCH workflow" href="notebooks/bitbirch_quickstart.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.0 (dev)" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-light-bw.svg" class="logo__image only-light" alt="BitBIRCH-Lean v0.0 (dev) Manual - Home"/>
    <img src="../_static/logo-dark-bw.svg" class="logo__image only-dark pst-js-only" alt="BitBIRCH-Lean v0.0 (dev) Manual - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installing.html">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user-guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../publications.html">
    Publications
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mqcomplab/bblean" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installing.html">
    Installing
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user-guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../publications.html">
    Publications
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mqcomplab/bblean" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="notebooks/bitbirch_quickstart.html">Simple BitBIRCH workflow</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Tuning BitBIRCH parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/bitbirch_best_practices.html">BitBIRCH best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_memory_setup.html">Linux Memory Setup</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user-guide.html" class="nav-link">User guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tuning BitBIRCH parameters</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tuning-bitbirch-parameters">
<span id="bblean-parameters"></span><h1>Tuning BitBIRCH parameters<a class="headerlink" href="#tuning-bitbirch-parameters" title="Link to this heading">#</a></h1>
<p>BitBIRCH has a few parameters parameters that can be adjusted to modify the quality of
the resulting clustering.</p>
<p>Before reading this section we recommend taking a look at the <a class="reference internal" href="notebooks/bitbirch_quickstart.html"><span class="doc">quickstart notebook</span></a>,
so you are familiar with the basics.</p>
<section id="merge-criterion-and-tolerance">
<h2>Merge criterion and tolerance<a class="headerlink" href="#merge-criterion-and-tolerance" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">merge_criterion</span></code> is used to determine whether two clusters can be merged inside a
node in the BitBIRCH tree. The criteria may be asymetric (they consider differently
clusters already in the tree, <em>old clusters</em>, and clusters that are being inserted, or
<em>nominee clusters</em>). In the following, diameter-complement refers to <span class="math notranslate nohighlight">\(1 - D_{JT}\)</span>
and radius-complement to <span class="math notranslate nohighlight">\(1 - R_{JT}\)</span>. There are three main merge criteria
implemented:</p>
<ul class="simple">
<li><dl class="simple">
<dt>radius (symmetric):</dt><dd><p>The radius-complement of the <em>resulting cluster</em>
must be less or equal than the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>diameter (symmetric):</dt><dd><p>The diameter-complement (equivalently, the average similarity) of the
<em>resulting cluster</em> must be less or equal than the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerance-diameter (asymmetric):</dt><dd><p>The <em>diameter</em> criteria must be satisfied <strong>and</strong> the diameter-commplement of the
<em>resulting cluster</em> must be greater or equal to that of the <em>old cluster</em> (unless the
<em>old cluster</em> has a single fingerprint). Some slack can be provided with a value of
<code class="docutils literal notranslate"><span class="pre">tolerance</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerance-radius (asymmetric):</dt><dd><p>The <em>radius</em> criterion must be satisfied <strong>and</strong>
the radius-complement of the <em>resulting cluster</em> must be greater or equal to that of
the <em>old cluster</em> (unless the <em>old cluster</em> has a single fingerprint). Some slack
can be provided with a value of <code class="docutils literal notranslate"><span class="pre">tolerance</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerance-legacy (asymmetric):</dt><dd><p><strong>This is providded for compatibility with old BitBIRCH versions only, in general it
should be avoided.</strong> The <em>diameter</em> criterion must be satisfied <strong>and</strong> The value of
<span class="math notranslate nohighlight">\((isim(X \cup new_fp)(N + 1) - isim(X)(N - 1)) / 2\)</span> must be greater or equal
to that of the <em>old cluster</em> (unless the <em>old cluster</em> has a single fingerprint, or
the new cluster has more than one fingerprint). Some slack can be provided with a
value of <code class="docutils literal notranslate"><span class="pre">tolerance</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<p>Both <strong>tolerance-diameter</strong> and <strong>tolerance-radius</strong> reduce the <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> slack
exponentially as the cluster gets larger. This behaviour is usually desirable, but can
be turned off with <code class="docutils literal notranslate"><span class="pre">adaptive=False</span></code>.</p>
<p>Currently we recommend the <strong>diameter</strong> criteria for the initial build of the tree, and
the corresponding <strong>tolerance-diameter</strong> criteria for refinement and tree-combining. The
default slack value for tolerance (0.05) is good for most purposes, although you may
want no slack (tolerance=0) if it is important to maintain the average Tanimoto values
after refinement. Using a very large value for tolerance will flatten the isim
distribution.</p>
</section>
<section id="threshold">
<h2>Threshold<a class="headerlink" href="#threshold" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">threshold</span></code> determines the minimum metric acceptable within a given cluster.
If adding a new molecule to a cluster would result in a lower average similarity than
<code class="docutils literal notranslate"><span class="pre">threshold</span></code>, BitBIRCH will instead create a new cluster. High threshold values may
result in <em>many small, compact clusters</em>. Low threshold may result in <em>few large,
diffuse clusters</em>.</p>
<p>The clustering results for a given threshold value will depend <strong>on the kind of
fingerprint used</strong>. Sparse fingerprints (e. g. ECFPs) typically have lower pairwise
Jaccard-Tanimoto similarities, which means you will want a low threshold to recover
meaningful structure. Denser fingerprints (e. g. the default <code class="docutils literal notranslate"><span class="pre">rdkit</span></code>
fingerprints) require larger threshold.</p>
<p>A typical recommendation is to use a threshold in the range of <strong>0.3-0.4</strong> for ECFP4 or
ECFP6, and a threshold in the range of <strong>0.5-0.65</strong> for <code class="docutils literal notranslate"><span class="pre">rdkit</span></code> fingerprints. Within
these ranges the method is not very sensitive to the threshold value chosen, but
choosing the wrong range for a given fingerprint kind may be <strong>very disadvantageous</strong>.</p>
<p>If you want to automatically choose the best threshold for a given fingerprint value,
follow the steps outlined in the <a class="reference internal" href="notebooks/bitbirch_best_practices.html"><span class="doc">best practices notebook</span></a>.</p>
</section>
<section id="branching-factor">
<h2>Branching factor<a class="headerlink" href="#branching-factor" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">branching_factor</span></code> determines how many clusters each node of the BitBIRCH tree
can hold before splitting into new nodes. A high branching factor will result in fewer
nodes, which means tree insertions will better approximate a thorough search over the
full fingerprint set, and memory usage will be lower. However, a very high branching
factor, may also incurr in a higher computational cost.</p>
<p>A recommended branching factor that performs well in terms of memory use and compute
cost is 254. Higher branching factors may be useful to reduce memory usage when
clustering hundreds of millions of molecules, at the cost of some speed (for example you
may want 1000 for 100M-200M molecules).</p>
<p>The clustering results depend on the <code class="docutils literal notranslate"><span class="pre">branching_factor</span></code>, but only very weakly. Most of
the effect is limited to performance and memory usage.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="notebooks/bitbirch_quickstart.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Simple BitBIRCH workflow</p>
      </div>
    </a>
    <a class="right-next"
       href="notebooks/bitbirch_best_practices.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">BitBIRCH best practices</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2025  The Miranda-Quintana Lab and other BitBirch developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>